<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Báº£n Ä‘á»“ tráº¡m sáº¡c</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 600px; }
    body { font-family: Arial, sans-serif; margin: 10px; }
    h2 { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>Danh sÃ¡ch tráº¡m sáº¡c tá»« cÆ¡ sá»Ÿ dá»¯ liá»‡u</h2>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Táº¡o báº£n Ä‘á»“ máº·c Ä‘á»‹nh (trung tÃ¢m Viá»‡t Nam)
    var map = L.map('map').setView([14.0583, 108.2772], 6);

    // Layer ná»n báº£n Ä‘á»“ (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Láº¥y danh sÃ¡ch tráº¡m tá»« API backend
    fetch("http://localhost:3000/stations")
      .then(res => res.json())
      .then(data => {
        if (data.length === 0) {
          alert("âš  KhÃ´ng cÃ³ tráº¡m nÃ o trong cÆ¡ sá»Ÿ dá»¯ liá»‡u!");
          return;
        }

        let bounds = [];

        data.forEach(st => {
          // Popup hiá»ƒn thá»‹ thÃ´ng tin
          let popupContent = `
            <div>
              <b>${st.name}</b><br>
              ğŸ“ ${st.address ?? 'KhÃ´ng cÃ³'}<br>
              âš¡ CÃ´ng suáº¥t: ${st.power_kw ?? 'N/A'} kW<br>
              ğŸ”Œ Cá»•ng sáº¡c: ${(st.connectors ? JSON.parse(st.connectors).join(", ") : "KhÃ´ng rÃµ")}<br>
              ğŸ’° GiÃ¡: ${st.price_per_kwh ?? 'N/A'} Ä‘/kWh<br>
              ğŸ•’ Giá» má»Ÿ cá»­a: ${st.open_hours ?? 'KhÃ´ng rÃµ'}<br>
              Tráº¡ng thÃ¡i: <span style="color:${st.status === 'available' ? 'green' : 'red'}">${st.status}</span><br>
              <i>${st.notes ?? ''}</i><br><br>
              <button onclick="bookStation(${st.id})">Äáº·t chá»—</button>
            </div>
          `;

          // Táº¡o marker
          const marker = L.marker([st.latitude, st.longitude])
            .addTo(map)
            .bindPopup(popupContent);

          bounds.push([st.latitude, st.longitude]);
        });

        // Tá»± Ä‘á»™ng zoom Ä‘á»ƒ tháº¥y táº¥t cáº£ marker
        if (bounds.length > 0) {
          map.fitBounds(bounds);
        }
      })
      .catch(err => console.error("âŒ Lá»—i khi táº£i tráº¡m sáº¡c:", err));

    // HÃ m Ä‘áº·t chá»—
    function bookStation(id) {
      window.location.href = `booking.html?station=${id}`;
    }
  </script>
</body>
</html>
